<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StackEdit Markdown Editor</title>
  <!-- Include StackEdit.js from unpkg-CDN -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
  >
  <script src="https://unpkg.com/stackedit-js@1.0.7/docs/lib/stackedit.min.js"></script>
  <style>
body {
  margin: 20px;
  overflow: hidden;
}
#editor {
  width: 90%;
}
  </style>
</head>
<body>
  <h1>StackEdit Markdown Editor</h1>
  <!-- Textarea for editing Markdown -->
  <textarea id="editor" placeholder="Open StackEdit to see some content here..."></textarea>
  <!-- Button to open StackEdit -->
  <button id="open-stackedit">Open in StackEdit</button>
  <button id="view">View</button>
  <button id="save-as">Save As</button>
  <input id="filename" type="text" style="float: right; width: 20%; margin-right: 100px;" placeholder="Filename">
  <hr style="width: 96.5%;" />
  <br />
  <div id="preview"></div>
  <br /> <br />

  <script>
    // Get references to DOM elements
    let filename = "Untitled.md";
    const el = document.getElementById('editor');
    const openButton = document.getElementById('open-stackedit');
    const saveButton = document.getElementById('save-as');

    // Create a new Stackedit instance
    const stackedit = new Stackedit();

    // When the button is clicked, open StackEdit with the current textarea content
    openButton.addEventListener('click', () => {
      stackedit.openFile({
        name: filename, // optional file name
        content: {
          text: el.value // pass current Markdown content
        }
      });
    });

    // When the save as button is clicked open, Save As UI for saving the contents of el.innerText
    saveButton.addEventListener('click', () => {
      const blob = new Blob([el.value], { type: 'text/markdown;charset=utf-8' });
      if ( document.querySelector('#filename').value === '' ) {
        document.querySelector('#filename').value = filename;
      } filename = document.querySelector('#filename').value;
      document.querySelector('#filename').value = '';
      if (window.navigator.msSaveBlob) {
          window.navigator.msSaveBlob(blob, filename);
      } else {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
	  URL.revokeObjectURL(url);
	  document.body.removeChild(a);
        }
    })

    // Listen to StackEdit fileChange events and update the textarea
    stackedit.on('fileChange', (file) => {
      el.value = file.content.text;
    });
  </script>
</body>
</html>
